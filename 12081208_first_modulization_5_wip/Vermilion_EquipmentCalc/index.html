<!-- Vermilion_EquipmentCalc/index.html -->
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Vermilion: Architect Suite</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/formula.css">
    <style>
        /* Lobby Styles */
        #lobby-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: #111;
            color: #eee;
        }

        .lobby-title {
            font-size: 2rem;
            margin-bottom: 2rem;
            color: var(--accent, #f59e0b);
            font-weight: bold;
        }

        .lobby-btn-row {
            display: flex;
            gap: 20px;
        }

        .lobby-btn {
            width: 200px;
            height: 120px;
            background: #27272a;
            border: 1px solid #444;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: 0.2s;
        }

        .lobby-btn:hover {
            background: #3f3f46;
            border-color: var(--accent, #f59e0b);
            transform: translateY(-2px);
        }

        .lobby-btn h3 {
            margin: 0 0 10px 0;
            font-size: 1.2rem;
        }

        .lobby-btn p {
            margin: 0;
            font-size: 0.8rem;
            color: #aaa;
        }

        /* App Containers */
        #equipment-app,
        #trinket-app {
            display: none;
            /* Controlled by Lobby */
            height: 100vh;
            width: 100%;
        }

        /* Trinket Specific overrides */
        #trinket-app .sidebar {
            flex: 0 0 320px;
        }

        /* Same as Eq */
    </style>
</head>

<body>

    <div id="tooltip"></div>

    <!-- === LOBBY === -->
    <div id="lobby-screen">
        <div class="lobby-title">VERMILION: ARCHITECT SUITE</div>
        <div class="lobby-btn-row">
            <div class="lobby-btn" onclick="Lobby.startEquipment()">
                <h3>âš”ï¸ Equipment</h3>
                <p>ë¬´ê¸° / ë°©ì–´êµ¬ / ì‹ ë°œ</p>
            </div>
            <div class="lobby-btn" onclick="Lobby.startTrinket()">
                <h3>ğŸ§  Trinket</h3>
                <p>ì¥ì‹ êµ¬ (BQM v5.5)</p>
            </div>
        </div>
    </div>

    <!-- === EQUIPMENT CALCULATOR (Original) === -->
    <div id="equipment-app" class="workspace">
        <div class="sidebar">
            <div class="ctrl-group">
                <h3 style="border:none; margin:0 0 5px 0;">ğŸ‘¤ ì°©ìš© ìºë¦­í„° (Persona)</h3>
                <select id="selChar" onchange="calc()">
                    <option value="GENERIC">-- í‘œì¤€ (Generic) --</option>
                    <option value="FLESH">ì‹œì²´ê¸°ì‚¬ (ì²´ë ¥ ìì› ê³ íš¨ìœ¨)</option>
                    <option value="ALBANUS">ì•Œë°”ëˆ„ìŠ¤ (ë°©ì–´ ì‹œ ğŸ²+1)</option>
                    <option value="GAIUS">ê°€ì´ìš°ìŠ¤ (ì£¼ì‚¬ìœ„ ì¬êµ´ë¦¼)</option>
                    <option value="HECTOR">í—¥í† ë¥´ (ê¹¡ë°©ì–´ ì„ í˜¸)</option>
                    <option value="HEGIO">í—¤ê¸°ì˜¤ (ë„ë°•/ì˜¤ì—¼ ì„ í˜¸)</option>
                </select>
            </div>



            <div class="ctrl-group">
                <h3>ğŸ¯ ëª©í‘œ í‹°ì–´ (Target Tier)</h3>
                <select id="selTargetTier" onchange="calc()"
                    style="width:100%; padding:5px; background:#27272a; color:white; border:1px solid #444; border-radius:4px;">
                    <option value="T6">T6 (12.1 V)</option>
                    <option value="T5">T5 (17.6 V)</option>
                    <option value="T4" selected>T4 (26.4 V)</option>
                    <option value="T3">T3 (35.2 V)</option>
                    <option value="T2">T2 (Threshold Limit)</option>
                </select>
                <div style="font-size:0.75rem; color:#888; margin-top:5px;">
                    ì„¤ì •ëœ í‹°ì–´ì˜ ì›ìƒ· ê¸°ì¤€(Threshold)ì„ ì´ˆê³¼í•˜ë©´<br>
                    <span style="color:var(--accent)">+1.5 V</span>ì˜ ë³´ë„ˆìŠ¤ë¥¼ ì–»ìŠµë‹ˆë‹¤.
                </div>
            </div>


            <div>
                <h3>ğŸ² ì£¼ì‚¬ìœ„ ìµœì í™” (S<sub>opt</sub>)</h3>
                <div style="background:#27272a; padding:10px; border-radius:6px;">
                    <div style="display:flex; justify-content:space-between; font-size:0.85rem; align-items:center;">
                        <span style="color:#aaa">ì¶”ì²œ ì¡°í•©:</span>
                        <span id="dispComp" style="color:var(--accent); font-weight:bold; font-size:1.1rem;">-</span>
                    </div>
                    <div style="font-size:0.75rem; color:#666; margin-top:5px; text-align:right;">
                        * ì¥ë¹„ ìš©ëŸ‰ì— ë§ì¶° ìë™ ê³„ì‚°ë¨
                    </div>
                    <!-- Hidden elements for compatibility if any JS still references them (though sim.js was updated) -->
                    <input type="hidden" id="slCount" value="3">
                    <input type="hidden" id="slRatio" value="1">
                    <div id="dispCount" style="display:none">3</div>
                </div>
            </div>

            <div>
                <h3>ğŸ› ï¸ êµ¬ì„± ìš”ì†Œ</h3>
                <label style="color:var(--th-color)">3. ì„ê³„ê°’ (Condition)</label>
                <div class="palette-group" id="pal-th"></div>

                <label style="margin-top:20px; color:var(--eff-color)">2. ì¼ë°˜ íš¨ê³¼ / í‚¤ì›Œë“œ</label>
                <div class="palette-group" id="pal-eff"></div>

                <label style="margin-top:20px; color:var(--spec-color)">4. íŠ¹ìˆ˜ íš¨ê³¼ (Result)</label>
                <div class="palette-group" id="pal-spec"></div>
            </div>

            <div class="io-panel">
                <h3>ğŸ“‚ ë°ì´í„° ê´€ë¦¬ (I/O)</h3>
                <button class="btn file-io" onclick="exportEquipDB()">ğŸ“¤ ì¥ë¹„ íŒŒì¼ ì €ì¥ <span>(.veq)</span></button>
                <button class="btn file-io" onclick="document.getElementById('importDB').click()">ğŸ“¥ ì¥ë¹„ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
                    <span>(.veq)</span></button>
                <input type="file" id="importDB" accept=".veq,.json" style="display:none"
                    onchange="importEquipDB(this)">
            </div>
        </div>

        <div class="main">
            <div style="margin-bottom:10px;">
                <label>ì¥ë¹„ ì´ë¦„ (Name)</label>
                <input type="text" id="eqName" placeholder="ì˜ˆ: ê±°ì¸ì˜ ë„ë¼">
                <input type="text" id="eqFlavor" placeholder="ì¥ë¹„ ì„¤ëª… (Flavor Text)"
                    style="margin-top:5px; font-size:0.85rem; color:#aaa; border-color:#444; background:#1a1a1a;">
            </div>

            <div class="slot-selector">
                <div class="slot-btn active" data-slot="WEP" onclick="setSlot('WEP')">ğŸ’ª ë¬´ê¸° (1.0x)</div>
                <div class="slot-btn" data-slot="ARM" onclick="setSlot('ARM')">ğŸ«€ ë°©ì–´êµ¬ (1.2x)</div>
                <div class="slot-btn" data-slot="BOOT" onclick="setSlot('BOOT')">ğŸ¦µ ì‹ ë°œ (1.0x)</div>
            </div>

            <div class="equip-card WEP" id="cardUI">
                <div class="card-section">
                    <div class="sec-title"><span>1. ìš©ëŸ‰ (Capacity)</span> <span id="valCap">0V</span></div>
                    <div class="cap-slots" onclick="cycleCap()">
                        <div class="cap-slot active"></div>
                        <div class="cap-slot active"></div>
                        <div class="cap-slot active"></div>
                        <div class="cap-slot"></div>
                        <div class="cap-slot"></div>
                    </div>
                    <div style="text-align:center; font-size:0.75rem; color:#666; margin-top:5px;">* ë¡œê·¸ ìŠ¤ì¼€ì¼ (2ì¹¸:1.0V
                        ~
                        5ì¹¸:2.8V)</div>
                </div>

                <div class="card-section">
                    <div class="sec-title"><span>2. ì¼ë°˜ íš¨ê³¼ (Always Active)</span> <span id="valBase">0V</span></div>
                    <div class="drop-area" id="dropBase"></div>
                </div>

                <div class="card-section" style="flex:1; overflow:hidden; display:flex; flex-direction:column;">
                    <div class="sec-title">
                        <span>3 & 4. íŠ¹ìˆ˜ íš¨ê³¼ ë¡œì§ (Condition âœ Result)</span>
                        <button onclick="addLogicRow()"
                            style="background:#333; border:1px solid #555; color:var(--accent); cursor:pointer; font-weight:bold; padding:4px 8px; border-radius:4px;">+
                            ë¡œì§ ì¶”ê°€</button>
                    </div>
                    <div id="logicContainer"
                        style="flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:10px; padding-right:5px;">
                    </div>
                </div>
            </div>

            <div class="result-box">
                <div class="metric">
                    <span class="res-label">í‰ê·  ë“±ê¸‰ (EQV)</span>
                    <span class="res-val" id="resScore">0.0</span>
                    <span class="res-grade" id="resGrade">T6</span>
                </div>

                <div class="metric">
                    <span class="res-label">ìµœëŒ€ ê³ ì  (MAX)</span>
                    <div class="res-val-group">
                        <span class="res-val" id="resMax" style="color:#f59e0b">0.0</span>
                        <span class="res-denom">/ 12.0</span>
                    </div>
                    <span class="res-sub" id="resMaxContext">ì ì¬ë ¥ (T6 íê¸‰)</span>
                </div>

                <div class="metric">
                    <span class="res-label">ì•ˆì •ì„± (STB)</span>
                    <span class="res-val" id="resStb" style="color:#10b981">0%</span>
                    <span class="res-sub">Activation Rate</span>
                </div>
            </div>

            <div id="formulaDisplay" class="formula-bar">
                <!-- Formula injected here by JS -->
            </div>

            <div class="bottom-bar">
                <div
                    style="display:flex; justify-content:space-between; font-size:0.8rem; color:#888; margin-bottom:5px;">
                    <span>TIER SCALE (Equipment)</span> <span>ARTIFACT LEVEL (12.0 V+)</span>
                </div>
                <div class="tier-track">
                    <div class="tier-seg t6">T6 íê¸‰</div>
                    <div class="tier-seg t5">T5 ì¼ë°˜</div>
                    <div class="tier-seg t4">T4 ê³ ê¸‰</div>
                    <div class="tier-seg t3">T3 í¬ê·€</div>
                    <div class="tier-seg t2">T2 ì „ì„¤</div>
                    <div class="tier-seg t1">T1 ì‹ í™”</div>
                    <div class="tier-marker" id="tierMarker" style="left:0%">
                        <div class="tier-label" id="tierLabel">0.0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- === TRINKET CALCULATOR (New) === -->
    <div id="trinket-app" class="workspace">
        <!-- Trinket Sidebar -->
        <div class="sidebar">
            <div class="ctrl-group">
                <h3>ğŸ› ï¸ ì¥ì‹ êµ¬ ì†ì„±</h3>
                <label style="color:var(--eff-color)">ì¥ì‹ êµ¬ íš¨ê³¼ (Effect)</label>
                <div class="palette-group" id="tr-pal-eff"></div>
            </div>

            <div class="ctrl-group">
                <h3>ğŸ”‹ ì¶©ì „ ì¡°ê±´ (Recharge)</h3>
                <div class="palette-group" id="tr-pal-rec"></div>
            </div>

            <div class="io-panel">
                <h3>ğŸ“‚ ì¥ì‹ êµ¬ ë°ì´í„° (I/O)</h3>
                <button class="btn file-io" onclick="exportTrinketDB()">ğŸ“¤ ì¥ì‹ êµ¬ ì €ì¥ <span>(.veq)</span></button>
                <button class="btn file-io" onclick="document.getElementById('importTrDB').click()">ğŸ“¥ ì¥ì‹ êµ¬ ë¶ˆëŸ¬ì˜¤ê¸°
                    <span>(.veq)</span></button>
                <input type="file" id="importTrDB" accept=".veq,.json" style="display:none"
                    onchange="importTrinketDB(this)">
            </div>
        </div>

        <!-- Trinket Main -->
        <div class="main">
            <div style="margin-bottom:10px;">
                <label>ì¥ì‹ êµ¬ ì´ë¦„ (Name)</label>
                <input type="text" id="trinketName" placeholder="ì˜ˆ: ì˜ˆì§€ìì˜ ë‹¨ì•ˆê²½">
                <input type="text" id="trinketFlavor" placeholder="ì¥ì‹ êµ¬ ì„¤ëª… (Flavor Text)"
                    style="margin-top:5px; font-size:0.85rem; color:#aaa; border-color:#444; background:#1a1a1a;">
            </div>

            <div class="slot-selector">
                <div class="slot-btn active" style="font-weight:bold; color:var(--accent); border-color:var(--accent);">
                    ğŸ§  ì¥ì‹ êµ¬ ì•„í‚¤í…íŠ¸ (Trinket Mode)</div>
            </div>

            <div class="equip-card ACC" id="trinketUI">
                <!-- Section 1: Capacity & Effect -->
                <div class="card-section">
                    <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                        <div>
                            <div class="sec-title">1. ì‚¬ìš© íšŸìˆ˜ (Capacity)</div>
                            <div id="trCapSlots" class="cap-slots" style="margin-top:5px;">
                                <!-- Filled by JS -->
                            </div>
                        </div>
                        <div style="text-align:right;">
                            <div class="sec-title" style="justify-content:flex-end;">ì´ ê°€ìš©ëŸ‰</div>
                            <div id="trCapVal" style="font-size:1.2rem; color:var(--accent); font-weight:bold;">1íšŒ</div>
                        </div>
                    </div>
                </div>

                <!-- Section 2: Effect Drop Zone -->
                <div class="card-section" style="flex:1; min-height:100px; display:flex; flex-direction:column;">
                    <div class="sec-title">2. ì¥ì‹ êµ¬ íš¨ê³¼ (Effect)</div>
                    <div class="drop-area" id="dropTrinketEff" style="flex:1; overflow-y:auto; height:auto;"></div>
                </div>

                <!-- Section 3: Recharge Drop Zone -->
                <div class="card-section">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div class="sec-title">3. ì¶©ì „ ì¡°ê±´ (Recharge Condition)</div>
                        <div style="display:flex; align-items:center;">
                            <label for="chkTrRecharge"
                                style="margin-right:5px; font-size:0.8rem; color:#888; cursor:pointer;">í™œì„±í™”</label>
                            <input type="checkbox" id="chkTrRecharge"
                                onchange="if(typeof toggleTrRecharge === 'function') toggleTrRecharge()" checked>
                        </div>
                    </div>
                    <div class="drop-area" id="dropTrinketRec" style="height:60px;"></div>
                </div>
            </div>

            <!-- Result Box -->
            <div class="result-box">
                <div class="metric">
                    <span class="res-label">ì¢…í•© ë“±ê¸‰ (Score)</span>
                    <span class="res-val" id="trResScore">0.0</span>
                    <span class="res-grade" id="trResGrade">T6</span>
                </div>

                <div class="metric">
                    <span class="res-label">íšŒë‹¹ ê°€ì¹˜ (Val/Use)</span>
                    <span class="res-val" id="trResVal" style="color:#f59e0b">0.0 V</span>
                </div>

                <div class="metric">
                    <span class="res-label">ìœ íš¨ ì‚¬ìš© íšŸìˆ˜ (N_eff)</span>
                    <span class="res-val" id="trResUses" style="color:#10b981">0.0</span>
                    <span class="res-sub">Capacity + Recharge</span>
                </div>
            </div>

            <div id="trinketFormulaDisplay" class="formula-bar">
                <!-- Formula injected here by JS -->
            </div>

            <div class="bottom-bar">
                <div
                    style="display:flex; justify-content:space-between; font-size:0.8rem; color:#888; margin-bottom:5px;">
                    <span>TIER SCALE (Trinket)</span> <span>GOD TIER (20.0 V+)</span>
                </div>
                <div class="tier-track">
                    <div class="tier-seg t6" style="flex:2">T6 íê¸‰</div> <!-- Adjusted widths for Trinket scale -->
                    <div class="tier-seg t5" style="flex:3">T5 ì¼ë°˜</div>
                    <div class="tier-seg t4" style="flex:5">T4 ê³ ê¸‰</div>
                    <div class="tier-seg t3" style="flex:5">T3 í¬ê·€</div>
                    <div class="tier-seg t2" style="flex:5">T2 ì „ì„¤</div>
                    <div class="tier-seg t1" style="flex:5">T1 ì‹ í™”</div>
                    <div class="tier-marker" id="trTierMarker" style="left:0%">
                        <div class="tier-label" id="trTierLabel">0.0</div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Scripts -->
    <!-- Original Scripts -->
    <script src="js/data.js"></script>
    <script src="js/state.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/sim.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/io.js"></script>
    <script src="js/main.js"></script>

    <!-- New Scripts (Trinket & Lobby) -->
    <script src="js/trinket_data.js"></script>
    <script src="js/trinket_state.js"></script>
    <script src="js/trinket_calc.js"></script>
    <script src="js/trinket_ui.js"></script>
    <script src="js/trinket_io.js"></script>

    <script src="js/lobby.js"></script>

</body>

</html>